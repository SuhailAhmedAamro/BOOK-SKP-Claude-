# باب 3: ROS 2 فن تعمیر

> "ROS جدید روبوٹکس کا اعصابی نظام ہے—سینسرز، الگورتھمز، اور ایکچویٹرز کو ایک متحد ذہین نظام میں جوڑتا ہے۔"

## فہرست

1. [ROS 2 کا تعارف](#introduction)
2. [بنیادی تصورات](#core-concepts)
3. [مواصلاتی نمونے](#communication)
4. [کمپیوٹیشن گراف](#computation-graph)
5. [کوالٹی آف سروس (QoS)](#qos)
6. [ROS 2 بمقابلہ ROS 1](#comparison)
7. [تنصیب اور سیٹ اپ](#installation)
8. [آپ کا پہلا ROS 2 نوڈ](#first-node)
9. [کمانڈ لائن ٹولز](#cli-tools)
10. [بہترین طریقے](#best-practices)

---

## ROS 2 کا تعارف {#introduction}

**ROS (Robot Operating System)** دراصل ایک آپریٹنگ سسٹم نہیں ہے—یہ روبوٹ سافٹ ویئر لکھنے کے لیے ایک لچکدار فریم ورک اور مڈل ویئر ہے۔ ROS 2 اگلی نسل ہے، جسے ROS 1 کی حدود کو دور کرنے کے لیے بنیاد سے نیا ڈیزائن کیا گیا ہے۔

### ROS 2 کیا ہے؟

ROS 2 فراہم کرتا ہے:

- **مواصلاتی بنیادی ڈھانچہ** تقسیم شدہ روبوٹ سسٹمز کے لیے
- **معیاری پیغام کی شکلیں** سینسرز اور ایکچویٹرز کے لیے
- **ٹولز** تصوراتی نمائش، ڈیبگنگ، اور سمولیشن کے لیے
- **لائبریریاں** عام روبوٹکس الگورتھمز کے لیے
- **ہارڈویئر تجریدی** تہہ

### ROS 2 کیوں؟

**ROS 1 پر بہتریاں:**

| خصوصیت | ROS 1 | ROS 2 |
|---------|-------|-------|
| **ریئل ٹائم** | کوئی ضمانت نہیں | ریئل ٹائم قابل |
| **سیکیورٹی** | کوئی نہیں | DDS سیکیورٹی |
| **ملٹی روبوٹ** | مشکل | مقامی معاونت |
| **ایمبیڈڈ** | محدود | مائیکروکنٹرولر معاونت |
| **مواصلات** | حسب ضرورت TCPROS | صنعتی معیار DDS |
| **لائف سائیکل** | بنیادی | جدید نوڈ لائف سائیکل |
| **QoS** | محدود | قابل ترتیب QoS پالیسیاں |

### ROS 2 کب استعمال کریں

**بہترین کے لیے:**
- ✅ تحقیق اور پروٹو ٹائپنگ
- ✅ ملٹی روبوٹ سسٹمز
- ✅ ریئل ٹائم کنٹرول
- ✅ پروڈکشن روبوٹکس
- ✅ حفاظتی اہم ایپلیکیشنز

**مثالی نہیں:**
- ❌ سادہ واحد مقصدی آلات
- ❌ انتہائی محدود وسائل والے سسٹمز
- ❌ غیر روبوٹکس ایپلیکیشنز

---

## بنیادی تصورات {#core-concepts}

ROS 2 کئی بنیادی تصورات کے گرد بنایا گیا ہے جو تمام روبوٹ ایپلیکیشنز کی بنیاد بناتے ہیں۔

### نوڈز

ایک **نوڈ** ایک واحد قابل عمل پروگرام ہے جو کمپیوٹیشن انجام دیتا ہے۔ نوڈز ROS سسٹمز کے بلڈنگ بلاکس ہیں۔

**خصوصیات:**
- خود مکمل عمل
- ایک مخصوص کام انجام دیتا ہے
- دوسرے نوڈز سے رابطہ کرتا ہے
- Python، C++، یا دیگر زبانوں میں لکھا جا سکتا ہے

**مثال نوڈ کی اقسام:**

| نوڈ کی قسم | مقصد | مثال |
|-----------|---------|---------|
| **ڈرائیور** | ہارڈویئر انٹرفیس | کیمرہ ڈرائیور، موٹر کنٹرولر |
| **الگورتھم** | ڈیٹا پروسیسنگ | آبجیکٹ ڈیٹیکشن، SLAM |
| **کنٹرولر** | روبوٹ کنٹرول | نیویگیشن، ہیرا پھیری |
| **ٹول** | افادیت | لاگر، مانیٹر، ویژولائزر |

```python
# Python میں کم سے کم ROS 2 نوڈ
import rclpy
from rclpy.node import Node

class MinimalNode(Node):
    def __init__(self):
        super().__init__('minimal_node')
        self.get_logger().info('نوڈ شروع ہو گیا!')

def main():
    rclpy.init()
    node = MinimalNode()
    rclpy.spin(node)
    node.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

### ٹاپکس

**ٹاپکس** پبلش-سبسکرائب پیٹرن استعمال کرتے ہوئے نوڈز کے درمیان مسلسل ڈیٹا سٹریمنگ کو قابل بناتے ہیں۔

**ٹاپکس کیسے کام کرتے ہیں:**

```
پبلشر نوڈ → ٹاپک → سبسکرائبر نوڈ(ز)
                  ↓
            پیغام کی قسم
```

**خصوصیات:**
- **بہت سے سے بہت سے**: متعدد پبلشرز اور سبسکرائبرز
- **گمنام**: پبلشرز سبسکرائبرز کے بارے میں نہیں جانتے
- **غیر مطابقتی**: نان بلاکنگ مواصلات
- **ٹائپ شدہ**: ہر ٹاپک کی ایک پیغام کی قسم ہے

**عام ٹاپک کی مثالیں:**

| ٹاپک کا نام | پیغام کی قسم | مقصد |
|------------|--------------|---------|
| `/camera/image` | `sensor_msgs/Image` | کیمرہ فیڈ |
| `/cmd_vel` | `geometry_msgs/Twist` | روبوٹ کی رفتار |
| `/scan` | `sensor_msgs/LaserScan` | LiDAR ڈیٹا |
| `/odom` | `nav_msgs/Odometry` | روبوٹ اوڈومیٹری |
| `/joint_states` | `sensor_msgs/JointState` | جوائنٹ پوزیشنز |

```python
# پبلشر کی مثال
from geometry_msgs.msg import Twist

class VelocityPublisher(Node):
    def __init__(self):
        super().__init__('velocity_publisher')
        self.publisher = self.create_publisher(Twist, '/cmd_vel', 10)
        self.timer = self.create_timer(0.1, self.publish_velocity)
    
    def publish_velocity(self):
        msg = Twist()
        msg.linear.x = 0.5  # 0.5 m/s آگے
        msg.angular.z = 0.0  # کوئی گردش نہیں
        self.publisher.publish(msg)
```

```python
# سبسکرائبر کی مثال
class VelocitySubscriber(Node):
    def __init__(self):
        super().__init__('velocity_subscriber')
        self.subscription = self.create_subscription(
            Twist,
            '/cmd_vel',
            self.velocity_callback,
            10)
    
    def velocity_callback(self, msg):
        self.get_logger().info(
            f'لکیری: {msg.linear.x:.2f}, زاویہ: {msg.angular.z:.2f}')
```

### سروسز

**سروسز** مطابقتی درخواست-جواب مواصلات کو نافذ کرتی ہیں۔

**سروسز کیسے کام کرتی ہیں:**

```
کلائنٹ نوڈ → درخواست → سروس سرور
                          ↓
کلائنٹ نوڈ ← جواب ← سروس سرور
```

**خصوصیات:**
- **ایک سے ایک**: واحد کلائنٹ، واحد سرور
- **مطابقتی**: کلائنٹ جواب کا انتظار کرتا ہے
- **ٹائپ شدہ**: درخواست اور جواب کی اقسام
- **عارضی**: کوئی ڈیٹا برقراری نہیں

**عام سروس کی مثالیں:**

| سروس کا نام | قسم | مقصد |
|--------------|------|---------|
| `/reset_simulation` | `std_srvs/Empty` | سمولیٹر کو ری سیٹ کریں |
| `/spawn_entity` | `gazebo_msgs/SpawnEntity` | روبوٹ کو سپان کریں |
| `/set_parameters` | `rcl_interfaces/SetParameters` | نوڈ کو تشکیل دیں |
| `/get_map` | `nav_msgs/GetMap` | نقشہ ڈیٹا کی درخواست کریں |

```python
# سروس سرور کی مثال
from std_srvs.srv import SetBool

class ServiceServer(Node):
    def __init__(self):
        super().__init__('service_server')
        self.srv = self.create_service(
            SetBool,
            '/enable_motors',
            self.enable_callback)
    
    def enable_callback(self, request, response):
        if request.data:
            self.get_logger().info('موٹرز فعال ہیں')
            response.success = True
            response.message = 'موٹرز اب چالو ہیں'
        else:
            self.get_logger().info('موٹرز غیر فعال ہیں')
            response.success = True
            response.message = 'موٹرز اب بند ہیں'
        return response
```

### ایکشنز

**ایکشنز** طویل المیعاد کاموں کے لیے ہیں جنہیں فیڈ بیک کی ضرورت ہوتی ہے اور منسوخ کیے جا سکتے ہیں۔

**ایکشنز کیسے کام کرتے ہیں:**

```
ایکشن کلائنٹ → ہدف → ایکشن سرور
               ↓
ایکشن کلائنٹ ← فیڈبیک ← ایکشن سرور (وقفہ وقفہ سے)
               ↓
ایکشن کلائنٹ ← نتیجہ ← ایکشن سرور (حتمی)
```

**خصوصیات:**
- **غیر مطابقتی**: نان بلاکنگ
- **فیڈبیک**: پیشرفت کی تازہ کاریاں
- **منسوخ کرنے کے قابل**: روکا جا سکتا ہے
- **ہدف پر مبنی**: مخصوص مقاصد

### پیرامیٹرز

**پیرامیٹرز** تشکیلی اقدار ہیں جنہیں نوڈز رن ٹائم پر حاصل اور سیٹ کر سکتے ہیں۔

**پیرامیٹر کی اقسام:**
- `bool`
- `integer`
- `double`
- `string`
- `byte_array`
- `bool_array`, `integer_array`, `double_array`, `string_array`

```python
# پیرامیٹرز کا استعمال
class ParameterNode(Node):
    def __init__(self):
        super().__init__('parameter_node')
        
        # ڈیفالٹ کے ساتھ پیرامیٹرز کا اعلان کریں
        self.declare_parameter('robot_name', 'my_robot')
        self.declare_parameter('max_speed', 1.0)
        self.declare_parameter('use_lidar', True)
        
        # پیرامیٹر کی قدریں حاصل کریں
        robot_name = self.get_parameter('robot_name').value
        max_speed = self.get_parameter('max_speed').value
        use_lidar = self.get_parameter('use_lidar').value
        
        self.get_logger().info(f'روبوٹ: {robot_name}')
        self.get_logger().info(f'زیادہ سے زیادہ رفتار: {max_speed} m/s')
        self.get_logger().info(f'LiDAR فعال: {use_lidar}')
```

**کمانڈ لائن سے پیرامیٹرز سیٹ کرنا:**

```bash
ros2 run my_package my_node --ros-args -p robot_name:=robot1 -p max_speed:=2.0
```

---

## مواصلاتی نمونے {#communication}

ROS 2 مختلف استعمال کی صورتوں کے لیے مختلف مواصلاتی نمونوں کی حمایت کرتا ہے۔

### نمونے کا موازنہ

| نمونہ | استعمال کی صورت | تاخیر | ضمانت |
|---------|----------|---------|-----------|
| **ٹاپک** | سٹریمنگ ڈیٹا | کم | بہترین کوشش یا قابل اعتماد |
| **سروس** | درخواست-جواب | درمیانہ | قابل اعتماد |
| **ایکشن** | طویل کام | درمیانہ-زیادہ | فیڈبیک کے ساتھ قابل اعتماد |

### ہر ایک کب استعمال کریں

**ٹاپکس استعمال کریں جب:**
- مسلسل ڈیٹا سٹریم (سینسر ریڈنگز)
- متعدد سبسکرائبرز کی ضرورت ہو
- ڈیٹا کبھی کبھار چھوڑا جا سکتا ہو
- کم تاخیر کی ضرورت ہو

**سروسز استعمال کریں جب:**
- ایک بار کی درخواستیں
- جواب کی ضرورت ہو
- مطابقتی آپریشن قابل قبول ہو
- تشکیل یا کنٹرول

**ایکشنز استعمال کریں جب:**
- طویل المیعاد آپریشنز
- پیشرفت فیڈبیک کی ضرورت ہو
- منسوخی کی معاونت کی ضرورت ہو
- ہدف پر مبنی کام

---

## کمپیوٹیشن گراف {#computation-graph}

**کمپیوٹیشن گراف** نوڈز اور ان کے مواصلاتی روابط کا نیٹ ورک ہے۔

### گراف اجزاء

```
        ٹاپک: /scan
           ↓
[LiDAR نوڈ] → ٹاپک: /cloud → [SLAM نوڈ] → ٹاپک: /map
                                     ↓
                              سروس: /save_map
```

### گراف کی تصوراتی نمائش

```bash
# rqt_graph انسٹال کریں
sudo apt install ros-humble-rqt-graph

# تصوراتی نمائش چلائیں
rqt_graph
```

---

## کوالٹی آف سروس (QoS) {#qos}

QoS پالیسیاں ROS 2 میں پیغامات کی فراہمی کو کنٹرول کرتی ہیں۔

### QoS پالیسیاں

| پالیسی | اختیارات | مقصد |
|--------|---------|---------|
| **قابل اعتمادی** | بہترین کوشش، قابل اعتماد | فراہمی کی ضمانت |
| **پائیداری** | عدم استحکام، عارضی مقامی | پیغام کی برقراری |
| **تاریخ** | آخری رکھیں، سب رکھیں | پیغام بفرنگ |
| **گہرائی** | نمبر (مثلاً 10) | بفر کا سائز |

---

## ROS 2 بمقابلہ ROS 1 {#comparison}

### فن تعمیر کے فرق

| پہلو | ROS 1 | ROS 2 |
|--------|-------|-------|
| **ماسٹر** | ضروری (roscore) | ضرورت نہیں |
| **دریافت** | مرکزی | تقسیم شدہ (DDS) |
| **Python** | Python 2.7 | Python 3.6+ |
| **بلڈ سسٹم** | catkin | ament/colcon |
| **پیغام کی شکل** | .msg فائلیں | .msg/.idl فائلیں |
| **مڈل ویئر** | حسب ضرورت TCPROS | DDS (پلگ ایبل) |

---

## تنصیب اور سیٹ اپ {#installation}

### ROS 2 Humble کی تنصیب (Ubuntu 22.04)

```bash
# ذرائع سیٹ اپ کریں
sudo apt update && sudo apt install software-properties-common
sudo add-apt-repository universe
sudo apt update && sudo apt install curl
sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key \
    -o /usr/share/keyrings/ros-archive-keyring.gpg

# ROS 2 انسٹال کریں
sudo apt update
sudo apt upgrade
sudo apt install ros-humble-desktop

# ڈیولپمنٹ ٹولز انسٹال کریں
sudo apt install ros-dev-tools

# ROS 2 کو سورس کریں
echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc
source ~/.bashrc
```

### ورک سپیس سیٹ اپ

```bash
# ورک سپیس بنائیں
mkdir -p ~/ros2_ws/src
cd ~/ros2_ws

# ورک سپیس بلڈ کریں
colcon build

# ورک سپیس کو سورس کریں
source install/setup.bash
```

---

## آپ کا پہلا ROS 2 نوڈ {#first-node}

آئیے ایک مکمل ROS 2 پیکیج بنائیں جس میں پبلشر اور سبسکرائبر ہوں۔

### پیکیج بنائیں

```bash
cd ~/ros2_ws/src
ros2 pkg create my_robot_controller \
    --build-type ament_python \
    --dependencies rclpy std_msgs geometry_msgs
```

### بلڈ اور چلائیں

```bash
# پیکیج بلڈ کریں
cd ~/ros2_ws
colcon build --packages-select my_robot_controller
source install/setup.bash

# پبلشر چلائیں (ٹرمینل 1)
ros2 run my_robot_controller publisher

# سبسکرائبر چلائیں (ٹرمینل 2)
ros2 run my_robot_controller subscriber
```

---

## کمانڈ لائن ٹولز {#cli-tools}

### ضروری کمانڈز

**نوڈ کمانڈز:**
```bash
ros2 node list                    # چلتے ہوئے نوڈز کی فہرست
ros2 node info /node_name         # نوڈ کی تفصیلات
```

**ٹاپک کمانڈز:**
```bash
ros2 topic list                   # تمام ٹاپکس کی فہرست
ros2 topic echo /topic_name       # پیغامات پرنٹ کریں
ros2 topic hz /topic_name         # پیغام کی تعدد
ros2 topic pub /topic_name ...    # پیغام شائع کریں
```

**سروس کمانڈز:**
```bash
ros2 service list                 # سروسز کی فہرست
ros2 service call /service_name   # سروس کال کریں
```

**پیرامیٹر کمانڈز:**
```bash
ros2 param list                   # پیرامیٹرز کی فہرست
ros2 param get /node_name param   # پیرامیٹر حاصل کریں
ros2 param set /node_name param value  # پیرامیٹر سیٹ کریں
```

**بیگ کمانڈز (ریکارڈنگ):**
```bash
ros2 bag record -a                # تمام ٹاپکس ریکارڈ کریں
ros2 bag play bag_file            # ریکارڈنگ دوبارہ چلائیں
ros2 bag info bag_file            # ریکارڈنگ کی معلومات دکھائیں
```

---

## بہترین طریقے {#best-practices}

### نوڈ ڈیزائن

**✅ کریں:**
- نوڈز کو چھوٹا اور مرکوز رکھیں
- معنی خیز نام استعمال کریں
- اہم واقعات لاگ کریں
- غلطیوں کو خوبصورتی سے سنبھالیں
- صاف شٹ ڈاؤن نافذ کریں

**❌ نہ کریں:**
- یک سنگی نوڈز نہ بنائیں
- ہارڈ کوڈڈ اقدار استعمال نہ کریں (پیرامیٹرز استعمال کریں)
- غلطی کی حالتوں کو نظر انداز نہ کریں
- کال بیکس میں بلاک نہ کریں
- عالمی متغیرات کا زیادہ استعمال نہ کریں

### مواصلات

**ٹاپک کے بہترین طریقے:**
- جب ممکن ہو معیاری پیغام کی اقسام استعمال کریں
- مناسب QoS پروفائلز منتخب کریں
- جب ضرورت نہ ہو تو اعلیٰ تعدد والے ٹاپکس سے بچیں
- ٹاپکس کو منطقی طور پر نام کی جگہ دیں

**سروس کے بہترین طریقے:**
- سروسز کو تیز رکھیں (< 1 سیکنڈ)
- معنی خیز اسٹیٹس کوڈز واپس کریں
- ڈیٹا سٹریمنگ کے لیے نہیں، تشکیل کے لیے سروسز استعمال کریں

**ایکشن کے بہترین طریقے:**
- باقاعدہ فیڈبیک فراہم کریں
- منسوخی کی معاونت کریں
- معقول ٹائم آؤٹ سیٹ کریں

---

## خلاصہ

ROS 2 جدید روبوٹ سسٹمز بنانے کے لیے ایک مضبوط، لچکدار فریم ورک فراہم کرتا ہے۔ اس کا تقسیم شدہ فن تعمیر، ریئل ٹائم صلاحیتیں، اور صنعتی معیار مڈل ویئر اسے تحقیق اور پروڈکشن روبوٹکس دونوں کے لیے پسند کا پلیٹ فارم بناتے ہیں۔

**اہم نکات:**

1. ✅ ROS 2 مڈل ویئر ہے، OS نہیں
2. ✅ نوڈز ٹاپکس، سروسز، اور ایکشنز کے ذریعے رابطہ کرتے ہیں
3. ✅ QoS پالیسیاں پیغام کی فراہمی کو کنٹرول کرتی ہیں
4. ✅ کوئی ماسٹر نوڈ کی ضرورت نہیں (تقسیم شدہ دریافت)
5. ✅ Python اور C++ بنیادی زبانیں ہیں
6. ✅ ڈیبگنگ اور تصوراتی نمائش کے لیے بہترین ٹولز

**اگلا باب:**

باب 4 میں، ہم ROS 2 مواصلاتی نمونوں میں گہرائی میں جائیں گے اور ٹاپکس، سروسز، اور ایکشنز کے ساتھ زیادہ پیچیدہ ملٹی نوڈ سسٹمز بنائیں گے۔

---

*اس باب نے ROS 2 فن تعمیر اور بنیادی تصورات متعارف کرائے۔ آپ نے پیکیج بنانا، نوڈز لکھنا، اور مواصلاتی بنیادی ڈھانچہ استعمال کرنا سیکھا جو جدید روبوٹکس کو طاقت دیتا ہے۔*